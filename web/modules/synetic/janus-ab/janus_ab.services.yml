services:
  jaybizzle.crawler_detect:
    class: Jaybizzle\CrawlerDetect\CrawlerDetect
  janus_ab.cookie_jar_factory:
    class: Drupal\janus_ab\Cookie\CookieJarFactory
  janus_ab.cookie_jar:
    class: Synetic\JanusAB\Cookie\BasicCookieJar
    factory: ['@janus_ab.cookie_jar_factory', create]
  janus_ab.config_factory:
    class: Drupal\janus_ab\Config\ABConfigFactory
    arguments: ['@config.factory']
  janus_ab.ab_config:
    class: Synetic\JanusAB\Config\ABConfig
    factory: ['@janus_ab.config_factory', create]
  janus_ab.variation_picker_factory:
    class: Drupal\janus_ab\Variation\VariationPickerFactory
    arguments: ['@janus_ab.ab_config', '@janus_ab.cookie_jar', '@request_stack', '@jaybizzle.crawler_detect']
  janus_ab.variation_picker:
    class: Synetic\JanusAB\Variation\VariationPickerInterface
    factory: ['@janus_ab.variation_picker_factory', create]
  janus_ab.janus_extension:
    class: Drupal\janus_ab\Twig\JanusExtension
    arguments: ['@janus_ab.variation_picker', '@janus_ab.ab_config', '@renderer', '@janus_ab.library_attacher']
    tags:
      - { name: twig.extension }
  janus_ab.logging_route_creator:
    class: Drupal\janus_ab\Routing\LoggingRouteCreator
    arguments: ['@janus_ab.ab_config']
  theiconic.analytics:
    class: TheIconic\Tracking\GoogleAnalytics\Analytics
  janus_ab.storage_handler:
    class: Synetic\JanusAB\DataStorage\StorageHandler
    tags:
      - { name: service_collector, tag: janus_ab.data_storage_handler, call: addStorageHandler }
  janus_ab.google_analytics_storage_handler:
    class: Drupal\janus_ab\DataStorage\GoogleAnalyticsStorageHandler
    arguments: ['@theiconic.analytics', '@janus_ab.ab_config']
    tags:
      - { name: janus_ab.data_storage_handler }
  janus_ab.ab_logger:
    class: Synetic\JanusAB\Logging\ABLogger
    arguments: ['@janus_ab.storage_handler']
  janus_ab.library_attacher:
    class: Drupal\janus_ab\JavaScript\LibraryAttacher
    arguments: ['@janus_ab.ab_config', '@janus_ab.variation_picker']
  janus_ab.request_handler:
    class: Drupal\janus_ab\Routing\JanusRequestHandler
    arguments: ['@janus_ab.ab_config', '@http_client']
  janus_ab.response_subscriber:
    class: Drupal\janus_ab\Routing\ResponseSubscriber
    tags:
      - { name: event_subscriber }
